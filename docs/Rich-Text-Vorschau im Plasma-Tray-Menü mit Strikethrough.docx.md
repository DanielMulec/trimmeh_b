# Rich-Text-Vorschau im Plasma-Tray-Menü mit Strikethrough

## Keine Unterstützung von QWidgetAction im Plasma-Tray-Menü

In KDE Plasma werden Tray-Menüs über den **StatusNotifierItem**- bzw. D-Bus-Menu-Mechanismus realisiert, nicht direkt durch die Anwendung. Wie ein Qt-Entwickler erläutert, wird die Menübeschreibung über DBus serialisiert und vom System (Plasma) gezeichnet – **ein Einbetten eigener Widgets (z. B. QLabel über QWidgetAction) ist daher nicht möglich**[\[1\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=I%20don%27t%20think%20that%20can,can%27t%20embed%20widgets%20in%20there). Das erklärt, warum das per `QWidgetAction` hinzugefügte QLabel im Kontextmenü **nicht** erscheint: Plasma kennt nur Standard-Menüeinträge (Text, Icon, Checkmarks etc.), aber keine kompletten QWidget-Elemente innerhalb des Menüs.

Diese Einschränkung gilt sowohl für `KStatusNotifierItem` (die KDE-Variante des Tray-Icons) als auch für `QSystemTrayIcon`, sofern unter Linux ein *„native menu“*-Modus aktiv ist. Intern kopiert Qt bei **native Menüs** alle QActions ins Plattform-Menü, **ignoriert dabei aber QWidgetActions vollständig**[\[2\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=Otherwise%20a%20native%20menu%20will,does%20not%20handle%20a%20QWidgetAction). Nur wenn kein natives Menüsupport verfügbar ist, wird das QMenu der App direkt angezeigt[\[3\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=I%27ve%20checked%20the%20source%20code,to%20show%20the%20context%20menu) – unter Plasma ist jedoch immer das native DBus-Menü im Einsatz, wodurch eingebettete Widgets wirkungslos bleiben.

## Einschränkungen von KStatusNotifierItem und QMenu unter KDE/Plasma

`KStatusNotifierItem` nutzt auf allen unterstützten Plattformen (insb. Plasma auf X11 *und* Wayland) den StatusNotifier/DBusMenu-Mechanismus. Das bedeutet in der Praxis: Das Kontextmenü eines Tray-Icons kann **nur einfache QAction-Einträge** enthalten. **Rich-Text-Formatierung wird nicht direkt unterstützt**, da die Menüeinträge als reiner Text (und optional Icon, Shortcut, etc.) übertragen werden. HTML-Markup im QAction-Text würde entweder als Klartext angezeigt oder herausgefiltert, aber nicht als Formatierung interpretiert.

Zwar erlaubt Qt grundsätzlich, einer QAction einen eigenen QFont zuzuweisen (z. B. monospaced oder mit StrikeOut-Stil)[\[4\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=item,isEnabled). Allerdings haben Anwendungen hier keine Kontrolle über die Plasma-Darstellung – Plasma verwendet für Tray-Menüs meist sein Standard-Design. Selbst wenn Qt den Font einer QAction über DBus meldet, kann das Plasma-Widget diese Angabe ignorieren. In der Praxis werden alle Menütexte in der vom Plasma-Thema vorgegebenen Schrift und Farbe gerendert. Auch Mehrzeiligkeit ist eingeschränkt: Ein QAction-Eintrag kann zwar Zeilenumbrüche enthalten, aber ein QLabel mit `wordWrap` ließe sich dadurch nicht ersetzen, da das Widget nicht gerendert wird.

**Fazit:** Unter KDE Plasma (und allgemein bei AppIndicator/StatusNotifier-Menüs) sind **keine benutzerdefinierten Widgets im Tray-Menü möglich**. Die leere Zeile im Menü ist ein Hinweis darauf, dass das System Ihren QWidgetAction-Eintrag nicht darstellen konnte[\[1\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=I%20don%27t%20think%20that%20can,can%27t%20embed%20widgets%20in%20there).

## Workarounds für eine formatierte Textvorschau im Tray-Menü

Da eine native Rich-Text-Anzeige im Tray-Menü nicht unterstützt wird, muss die Vorschau auf andere Weise dargestellt werden. Im Folgenden einige Ansätze:

- **Nicht-interaktive QAction als Label:** Anstatt eines QLabel im Menü kann man eine gewöhnliche QAction mit formatiertem Text benutzen und diese **deaktivieren**, um sie als rein informativen Eintrag anzuzeigen. Dieses Vorgehen hat ein Entwickler erfolgreich als Ersatz für ein QLabel genutzt[\[5\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=). Beispiel:

<!-- -->

    QAction* previewLabel = menu->addAction(previewText);
    previewLabel->setEnabled(false);  // wirkt wie ein statischer Label-Eintrag

Dadurch erscheint der Vorschau-Text im Menü (allerdings grau angezeigt, da disabled). Über `QAction::setVisible()` kann man den Eintrag bei Bedarf ein-/ausblenden. Hinweis: Ein Abschnitt (`QMenu::addSection`) könnte ebenfalls genutzt werden, falls man einen nicht klickbaren Menütitel einfügen möchte – dies wird jedoch üblicherweise **kursiv oder fett** dargestellt und ist eher für Überschriften gedacht.

- **Strikethrough im Plain-Text simulieren:** Um **durchgestrichenen Text ohne HTML** darzustellen, kann man Konventionen oder Unicode-Tricks nutzen:

- *Markdown-Syntax:* Im Plain-Text Umfeld wird durchzustreichender Text oft zwischen Doppel-Tildes markiert (z. B. `~~gelöscht~~`). Dieses Stilmittel kann man in den QAction-Text übernehmen, um dem Nutzer die entfernten Stellen anzudeuten[\[6\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=Is%20it%20possible%20to%20strike,this%20is%20with%20Unicode%20Characters). Zwar erscheint das Wort dann mit Tilden (z. B. *Original: \~~Text\~~*), aber der Bedeutungsinhalt „durchgestrichen“ bleibt erkennbar.

- *Unicode Kombinationszeichen:* Für einen tatsächlichen visuell durchgestrichenen Effekt kann das **kombinierende Überstreichungs-Zeichen** U+0336 verwendet werden. Dieses sogenannte *Combining Long Stroke Overlay* fügt über dem davorstehenden Buchstaben einen horizontalen Strich ein[\[7\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=31). Indem man jedem zu streichenden Zeichen dieses Zeichen anhängt, wirkt der Text durchgestrichen. Beispiel: Aus `"Test"` wird `"T̶e̶s̶t̶"` (mit U+0336 nach jedem Buchstaben). Dieses Verfahren ergibt optisch einen durchgehenden Strich über den Text. **Achtung:** Die Darstellung hängt von der Schriftart ab – in manchen Fonts deckt der Strich breite Zeichen nicht komplett ab, was etwas unschön aussehen kann[\[8\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=There%27s%20U%2B0336%2C%20COMBINING%20LONG%20STROKE,pretty%20terrible%20on%20my%20environment). Da Plasma-Menüs die Standard-Schrift benutzen, sollte man testen, wie der kombinierte Strich dort wirkt. In vielen Fällen ist dies jedoch ein praktikabler Weg, um Strikethrough ohne Rich-Text zu erreichen.

- **Monospace und sichtbare Zeichen:** Ihre aktuelle Lösung verwendete bereits eine feste Breite und Ersatzzeichen für Leerzeichen/Tabulatoren (·, ⇥ etc.). Bei Nutzung einer reinen QAction bleibt die Menü-Schrift vermutlich proportional. Ein geringer Nachteil ist, dass Abstände dann nicht mehr genau ausgerichtet sind. Falls genaue Ausrichtung wichtig ist, könnten Sie erwägen, dem QAction-Text einen Monospace-Font zuzuweisen (`previewLabel->setFont(monospaceFont)`). Ob Plasma diese Font-Einstellung beachtet, ist nicht garantiert, aber einen Versuch wert. Alternativ muss man damit leben, dass die Visualisierung geringfügig anders ist als im QLabel. Die Symbole für Leerzeichen und Tabs werden aber dennoch angezeigt (·, ↦), auch wenn sie proportional etwas variieren.

## Manuelles Anzeigen eines eigenen Menüs (X11-Hack)

Eine *theoretische* native Lösung, um dennoch ein QLabel im Menü zu sehen, besteht darin, **das Kontextmenü selbst zu zeichnen**, statt es Plasma zu überlassen. Konkret könnte man auf X11 die `contextMenuRequested`/`activated`-Signale des Tray-Icons abfangen und dann das eigene QMenu manuell via `popup()` anzeigen, anstatt `setContextMenu` zu verwenden[\[9\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20grisuthedragon%20The%20workaround%20I,tried%20that%2C%20just%20a%20thought). Dadurch würde das Menü komplett von der Anwendung gezeichnet (inklusive QWidgetAction-Inhalte). Dieses Verfahren wurde auf Qt-Foren als Workaround diskutiert.

**Problem dabei:** Zum einen ist dies unter Wayland nicht möglich (dort gibt es keine direkte Icon-Geometrie oder Tray-Icon-Kontrolle seitens der App). Zum anderen **umgeht man damit die Plasma-Integration**, was optisch und funktional nachteilig sein kann. Ein Entwickler berichtet, dass ein manuell gepopptes Menü nicht wie ein natives Plasma-Menü wirkt und von Nutzern als *„ungewöhnlich/unschön“* empfunden werden könnte[\[10\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20Bonnie%20That%20could%20be,the%20information%20in%20tray%27s%20menu). Zudem müsste man die Position des Menüs selbst berechnen (über die Icon-Koordinaten), was fehleranfällig ist, insbesondere bei verschiedenen Panel-Positionen oder Multi-Monitor-Setups.

Dieser Hack wird **nicht empfohlen**, außer in speziellen Umgebungen, da er die Konsistenz der Benutzeroberfläche bricht. Insbesondere für KDE/Plasma sollten Anwendungen den vorgesehenen Weg (StatusNotifierItem) nutzen und sich an dessen Grenzen halten.

## Unterschiede zwischen Wayland und X11

**X11:** Unter X11 unterstützt Plasma aus Kompatibilitätsgründen noch **Legacy-Tray-Icons (XEmbed)**. Wenn man statt `KStatusNotifierItem` ein normales `QSystemTrayIcon` nutzt *und* keine AppIndicator-Integration aktiv ist, erscheint das Kontextmenü als echtes QMenu der Anwendung. In diesem Fall würden `QWidgetAction` und QLabel tatsächlich funktionieren, da Qt das Menü selbst rendert. Allerdings setzt Plasma auf modernen Distributionen häufig einen AppIndicator/StatusNotifier-Proxy ein. Das bedeutet: Selbst auf X11 könnte Qt versuchen, das Menü via StatusNotifier (DBus) bereitzustellen, anstatt es direkt zu zeichnen[\[3\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=I%27ve%20checked%20the%20source%20code,to%20show%20the%20context%20menu). Die genauen Umstände hängen von Qt’s Plattformtheme und dem System ab. Auf einem „reinem“ Plasma (mit Qt’s KDE-Plattformtheme) werden QSystemTrayIcon-Menüs normalerweise als native Menüs behandelt – d.h. wieder keine Widgets.

**Wayland:** Hier gibt es kein XEmbed-Tray mehr. `QSystemTrayIcon` zeigt *gar kein* Icon, solange keine StatusNotifier-Schnittstelle verwendet wird. Folglich **muss** unter Wayland `KStatusNotifierItem` genutzt werden, was immer den DBus-Menüpfad nimmt. Eine native Menü-Anzeige durch die App ist damit ausgeschlossen. Kurz gesagt: **Unter Wayland steht keine Option für eingebettete Widgets zur Verfügung**, der Workaround mit manuellem Menü funktioniert dort nicht.

**Zusammengefasst:** Für eine portable Lösung (X11/Wayland) bleibt nur, das Tray-Menü über StatusNotifierItem zu betreiben und die Preview-Formatierung innerhalb der gegebenen Text-Mittel umzusetzen. Auf X11 könnten Sie zwar tricksen und bei verfügbarer XEmbed-Unterstützung ein eigenes Menü verwenden, doch das bricht unter Wayland und widerspricht der Plasma-Integration. Es ist stabiler, **die Vorschau als reinen Text mit Markierungen** darzustellen, anstatt auf eine native Rich-Text-Widget-Lösung zu hoffen, die Plasma derzeit nicht bietet. Die vorgeschlagenen Workarounds (deaktivierte QAction als Label[\[5\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=), Nutzung von `~~` oder Unicode-Überstreichung für Strikethrough[\[7\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=31)) haben sich in der Praxis bewährt, um Inhalte im Tray-Menü informativ aufzubereiten.

**Quellen:** Die Einschränkungen von Qt/Plasma bezüglich Tray-Menüs sind in Forendiskussionen und Entwicklerkommentaren dokumentiert[\[1\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=I%20don%27t%20think%20that%20can,can%27t%20embed%20widgets%20in%20there)[\[2\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=Otherwise%20a%20native%20menu%20will,does%20not%20handle%20a%20QWidgetAction). Die vorgeschlagenen Lösungen orientieren sich an Community-Erfahrungen und Best Practices aus Qt-Foren[\[5\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=) sowie an bekannten Plain-Text-Markup-Konventionen[\[11\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=Is%20it%20possible%20to%20strike,this%20is%20with%20Unicode%20Characters)[\[7\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=31). Zudem wurde in einem Qt-Forum der manuelle Menü-Workaround diskutiert, jedoch aus Integrationsgründen verworfen[\[9\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20grisuthedragon%20The%20workaround%20I,tried%20that%2C%20just%20a%20thought)[\[10\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20Bonnie%20That%20could%20be,the%20information%20in%20tray%27s%20menu). Diese Informationen wurden hier zusammengefasst, um eine robuste Lösung für die Rich-Text-Vorschau im Plasma-Tray zu finden.

------------------------------------------------------------------------

[\[1\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=I%20don%27t%20think%20that%20can,can%27t%20embed%20widgets%20in%20there) [\[5\]](https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray#:~:text=) qt - QWidgetAction doesn't work inside QMenu as a context menu for tray - Stack Overflow

<https://stackoverflow.com/questions/34370904/qwidgetaction-doesnt-work-inside-qmenu-as-a-context-menu-for-tray>

[\[2\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=Otherwise%20a%20native%20menu%20will,does%20not%20handle%20a%20QWidgetAction) [\[3\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=I%27ve%20checked%20the%20source%20code,to%20show%20the%20context%20menu) [\[4\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=item,isEnabled) [\[9\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20grisuthedragon%20The%20workaround%20I,tried%20that%2C%20just%20a%20thought) [\[10\]](https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction#:~:text=%40%20Bonnie%20That%20could%20be,the%20information%20in%20tray%27s%20menu) QTrayIcon context menu and QWidgetAction \| Qt Forum

<https://forum.qt.io/topic/114548/qtrayicon-context-menu-and-qwidgetaction>

[\[6\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=Is%20it%20possible%20to%20strike,this%20is%20with%20Unicode%20Characters) [\[7\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=31) [\[8\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=There%27s%20U%2B0336%2C%20COMBINING%20LONG%20STROKE,pretty%20terrible%20on%20my%20environment) [\[11\]](https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters#:~:text=Is%20it%20possible%20to%20strike,this%20is%20with%20Unicode%20Characters) Strike through plain text with unicode characters? - Stack Overflow

<https://stackoverflow.com/questions/38926669/strike-through-plain-text-with-unicode-characters>
